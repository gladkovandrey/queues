# Transaction Replication System - Homework 4,5

–°–∏—Å—Ç–µ–º–∞ –∫–æ–Ω—Å–∏—Å—Ç–µ–Ω—Ç–Ω–æ–π —Ä–µ–ø–ª–∏–∫–∞—Ü–∏–∏ —Ç—Ä–∞–Ω–∑–∞–∫—Ü–∏–π –º–µ–∂–¥—É –¥–≤—É–º—è –±–∞–∑–∞–º–∏ –¥–∞–Ω–Ω—ã—Ö —á–µ—Ä–µ–∑ NATS –æ—á–µ—Ä–µ–¥–∏ —Å **near real-time** –ø—Ä–æ–∏–∑–≤–æ–¥–∏—Ç–µ–ª—å–Ω–æ—Å—Ç—å—é.

## üèóÔ∏è –ê—Ä—Ö–∏—Ç–µ–∫—Ç—É—Ä–∞

```
Zone A                           Zone B
‚îå‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê         ‚îå‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê
‚îÇ PostgreSQL A        ‚îÇ         ‚îÇ PostgreSQL B        ‚îÇ
‚îÇ ‚îú‚îÄ users            ‚îÇ         ‚îÇ ‚îú‚îÄ users            ‚îÇ
‚îÇ ‚îú‚îÄ payments         ‚îÇ         ‚îÇ ‚îú‚îÄ payments         ‚îÇ
‚îÇ ‚îî‚îÄ outbox           ‚îÇ         ‚îÇ ‚îî‚îÄ inbox            ‚îÇ
‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îò         ‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îò
         ‚Üï                               ‚Üï
‚îå‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê         ‚îå‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê
‚îÇ NATS Cluster A      ‚îÇ  <‚îÄ‚îÄ‚îÄ>  ‚îÇ NATS Cluster B      ‚îÇ
‚îÇ ‚îú‚îÄ nats-a-1         ‚îÇ Gateway ‚îÇ ‚îú‚îÄ nats-b-1         ‚îÇ
‚îÇ ‚îú‚îÄ nats-a-2         ‚îÇ —Ä–µ–ø–ª–∏-  ‚îÇ ‚îú‚îÄ nats-b-2         ‚îÇ
‚îÇ ‚îî‚îÄ nats-a-3         ‚îÇ –∫–∞—Ü–∏—è   ‚îÇ ‚îî‚îÄ nats-b-3         ‚îÇ
‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îò         ‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îò
```

## üì¶ –ö–æ–º–ø–æ–Ω–µ–Ω—Ç—ã

- **data-generator** - –≥–µ–Ω–µ—Ä–∏—Ä—É–µ—Ç –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–π –∏ –ø–ª–∞—Ç–µ–∂–∏ –≤ Database A
- **outbox-publisher** - —á–∏—Ç–∞–µ—Ç outbox –∏–∑ DB A –∏ –æ—Ç–ø—Ä–∞–≤–ª—è–µ—Ç –≤ NATS A
- **inbox-processor** - —á–∏—Ç–∞–µ—Ç –∏–∑ NATS B –∏ –∑–∞–ø–∏—Å—ã–≤–∞–µ—Ç –≤ DB B
- **PostgreSQL A/B** - –¥–≤–µ –±–∞–∑—ã –¥–∞–Ω–Ω—ã—Ö
- **NATS Clusters** - –¥–≤–∞ –∫–ª–∞—Å—Ç–µ—Ä–∞ –ø–æ 3 –Ω–æ–¥—ã —Å Gateway —Ä–µ–ø–ª–∏–∫–∞—Ü–∏–µ–π

## üîÑ –ü–æ—Ç–æ–∫ –¥–∞–Ω–Ω—ã—Ö

1. **data-generator** —Å–æ–∑–¥–∞–µ—Ç –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–π –∏ –ø–ª–∞—Ç–µ–∂–∏ –≤ DB A
2. –ü—Ä–∏ –∫–∞–∂–¥–æ–π –∑–∞–ø–∏—Å–∏ –≤ –æ—Å–Ω–æ–≤–Ω—ã–µ —Ç–∞–±–ª–∏—Ü—ã —Å–æ–∑–¥–∞–µ—Ç—Å—è —Å–æ–±—ã—Ç–∏–µ –≤ **outbox**  
3. **outbox-publisher** —á–∏—Ç–∞–µ—Ç –Ω–æ–≤—ã–µ —Å–æ–±—ã—Ç–∏—è –∏–∑ outbox –∏ –æ—Ç–ø—Ä–∞–≤–ª—è–µ—Ç –≤ NATS A
4. NATS Gateway –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏ —Ä–µ–ø–ª–∏—Ü–∏—Ä—É–µ—Ç —Å–æ–±—ã—Ç–∏—è –≤ NATS B
5. **inbox-processor** —á–∏—Ç–∞–µ—Ç —Å–æ–±—ã—Ç–∏—è –∏–∑ NATS B –∏ –∑–∞–ø–∏—Å—ã–≤–∞–µ—Ç –≤ DB B —Å **–ø—Ä–∞–≤–∏–ª—å–Ω–æ–π —Å–æ—Ä—Ç–∏—Ä–æ–≤–∫–æ–π** (users ‚Üí payments)
6. –ò–¥–µ–º–ø–æ—Ç–µ–Ω—Ç–Ω–æ—Å—Ç—å –æ–±–µ—Å–ø–µ—á–∏–≤–∞–µ—Ç—Å—è —á–µ—Ä–µ–∑ UUID –∏ –ø—Ä–æ–≤–µ—Ä–∫—É –¥—É–±–ª–∏–∫–∞—Ç–æ–≤

## ‚ö° –ü—Ä–æ–∏–∑–≤–æ–¥–∏—Ç–µ–ª—å–Ω–æ—Å—Ç—å

**–û–ø—Ç–∏–º–∏–∑–∏—Ä–æ–≤–∞–Ω–Ω—ã–µ –Ω–∞—Å—Ç—Ä–æ–π–∫–∏:**
- **–ü—Ä–æ–ø—É—Å–∫–Ω–∞—è —Å–ø–æ—Å–æ–±–Ω–æ—Å—Ç—å**: 50+ —Å–æ–±—ã—Ç–∏–π/—Å–µ–∫—É–Ω–¥—É
- **–ó–∞–¥–µ—Ä–∂–∫–∞ —Ä–µ–ø–ª–∏–∫–∞—Ü–∏–∏**: 1-2 —Å–µ–∫—É–Ω–¥—ã (near real-time)
- **Batch Size**: 25 —Å–æ–±—ã—Ç–∏–π –Ω–∞ –ø–∞–∫–µ—Ç
- **Poll Interval**: 0.5 —Å–µ–∫—É–Ω–¥—ã
- **–ù–æ—Ä–º–∞–ª—å–Ω–æ–µ —Å–æ—Å—Ç–æ—è–Ω–∏–µ**: 0 –Ω–µ–æ–±—Ä–∞–±–æ—Ç–∞–Ω–Ω—ã—Ö —Å–æ–±—ã—Ç–∏–π –≤ outbox/inbox

## üöÄ –ó–∞–ø—É—Å–∫ —Å–∏—Å—Ç–µ–º—ã

```bash
# –ó–∞–ø—É—Å—Ç–∏—Ç—å –≤—Å—é –∏–Ω—Ñ—Ä–∞—Å—Ç—Ä—É–∫—Ç—É—Ä—É
./start-replication.sh

# –ü–æ—Å–º–æ—Ç—Ä–µ—Ç—å –ª–æ–≥–∏ –∫–æ–º–ø–æ–Ω–µ–Ω—Ç–æ–≤
./logs.sh data-generator
./logs.sh outbox-publisher  
./logs.sh inbox-processor

# –û—Å—Ç–∞–Ω–æ–≤–∏—Ç—å —Å–∏—Å—Ç–µ–º—É
./stop-replication.sh
```

## üìä –ú–æ–Ω–∏—Ç–æ—Ä–∏–Ω–≥

- **Database A**: localhost:5432 (user: postgres, pass: password)
- **Database B**: localhost:5433 (user: postgres, pass: password) 
- **NATS A**: http://localhost:8222 (admin:password123)
- **NATS B**: http://localhost:8223 (admin:password123)

## üîç –ü—Ä–æ–≤–µ—Ä–∫–∞ —Ä–∞–±–æ—Ç—ã —Å–∏—Å—Ç–µ–º—ã

### –ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∞—è –ø—Ä–æ–≤–µ—Ä–∫–∞
```bash
./check-replication.sh
```

**–ß—Ç–æ –ø—Ä–æ–≤–µ—Ä—è–µ—Ç —Å–∫—Ä–∏–ø—Ç:**

1. **üìä –°—Ç–∞—Ç—É—Å –∫–æ–Ω—Ç–µ–π–Ω–µ—Ä–æ–≤**
   - –ü—Ä–æ–≤–µ—Ä—è–µ—Ç —á—Ç–æ –≤—Å–µ –∫—Ä–∏—Ç–∏—á–Ω—ã–µ –∫–æ–Ω—Ç–µ–π–Ω–µ—Ä—ã –∑–∞–ø—É—â–µ–Ω—ã
   - –ö–æ–Ω—Ç—Ä–æ–ª–∏—Ä—É–µ—Ç: postgres-a, postgres-b, nats-a-1, nats-b-1, data-generator, outbox-publisher, inbox-processor

2. **üóÑÔ∏è –°–æ—Å—Ç–æ—è–Ω–∏–µ –±–∞–∑ –¥–∞–Ω–Ω—ã—Ö**
   - **Database A (–∏—Å—Ç–æ—á–Ω–∏–∫):** 
     - –ö–æ–ª–∏—á–µ—Å—Ç–≤–æ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–π –∏ –ø–ª–∞—Ç–µ–∂–µ–π
     - –ù–µ–æ–±—Ä–∞–±–æ—Ç–∞–Ω–Ω—ã–µ —Å–æ–±—ã—Ç–∏—è –≤ outbox (**–¥–æ–ª–∂–Ω–æ –±—ã—Ç—å 0 –≤ –Ω–æ—Ä–º–µ**)
     - –û–±—â–µ–µ –∫–æ–ª–∏—á–µ—Å—Ç–≤–æ —Å–æ–±—ã—Ç–∏–π –≤ outbox
   - **Database B (–Ω–∞–∑–Ω–∞—á–µ–Ω–∏–µ):**
     - –ö–æ–ª–∏—á–µ—Å—Ç–≤–æ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–π –∏ –ø–ª–∞—Ç–µ–∂–µ–π (**–¥–æ–ª–∂–Ω–æ —Å–æ–≤–ø–∞–¥–∞—Ç—å —Å DB A**)
     - –ù–µ–æ–±—Ä–∞–±–æ—Ç–∞–Ω–Ω—ã–µ —Å–æ–±—ã—Ç–∏—è –≤ inbox (**–¥–æ–ª–∂–Ω–æ –±—ã—Ç—å 0 –≤ –Ω–æ—Ä–º–µ**)
     - –û–±—â–µ–µ –∫–æ–ª–∏—á–µ—Å—Ç–≤–æ —Å–æ–±—ã—Ç–∏–π –≤ inbox
     - –ö–æ–ª–∏—á–µ—Å—Ç–≤–æ —É—Å–ø–µ—à–Ω–æ –æ–±—Ä–∞–±–æ—Ç–∞–Ω–Ω—ã—Ö —Å–æ–±—ã—Ç–∏–π

3. **‚öñÔ∏è –°—Ä–∞–≤–Ω–µ–Ω–∏–µ –¥–∞–Ω–Ω—ã—Ö**
   - –°—Ä–∞–≤–Ω–∏–≤–∞–µ—Ç –∫–æ–ª–∏—á–µ—Å—Ç–≤–æ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–π –≤ DB A –∏ DB B
   - –°—Ä–∞–≤–Ω–∏–≤–∞–µ—Ç –∫–æ–ª–∏—á–µ—Å—Ç–≤–æ –ø–ª–∞—Ç–µ–∂–µ–π –≤ DB A –∏ DB B
   - ‚úÖ –ó–µ–ª–µ–Ω—ã–π = –¥–∞–Ω–Ω—ã–µ —Å–∏–Ω—Ö—Ä–æ–Ω–∏–∑–∏—Ä–æ–≤–∞–Ω—ã –∏–¥–µ–∞–ª—å–Ω–æ
   - ‚ö†Ô∏è –ñ–µ–ª—Ç—ã–π = –µ—Å—Ç—å –º–∏–Ω–∏–º–∞–ª—å–Ω—ã–µ —Ä–∞—Å—Ö–æ–∂–¥–µ–Ω–∏—è (1-2 –∑–∞–ø–∏—Å–∏, –≤—Ä–µ–º–µ–Ω–Ω–∞—è –∑–∞–¥–µ—Ä–∂–∫–∞ < 5 —Å–µ–∫)

4. **üìã –ü–æ—Å–ª–µ–¥–Ω–∏–µ —Å–æ–±—ã—Ç–∏—è**
   - –ü–æ–∫–∞–∑—ã–≤–∞–µ—Ç –ø–æ—Å–ª–µ–¥–Ω–∏–µ 3 —Å–æ–∑–¥–∞–Ω–Ω—ã—Ö –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è –≤ DB A
   - –ü–æ–∫–∞–∑—ã–≤–∞–µ—Ç –ø–æ—Å–ª–µ–¥–Ω–∏–µ 3 —Ä–µ–ø–ª–∏—Ü–∏—Ä–æ–≤–∞–Ω–Ω—ã—Ö –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è –≤ DB B
   - –ü–æ–º–æ–≥–∞–µ—Ç —É–±–µ–¥–∏—Ç—å—Å—è —á—Ç–æ –¥–∞–Ω–Ω—ã–µ –∞–∫—Ç—É–∞–ª—å–Ω—ã–µ

5. **‚è±Ô∏è –ó–∞–¥–µ—Ä–∂–∫–∞ —Ä–µ–ø–ª–∏–∫–∞—Ü–∏–∏**
   - –í—Ä–µ–º—è —Å –º–æ–º–µ–Ω—Ç–∞ –ø–æ—Å–ª–µ–¥–Ω–µ–≥–æ —Å–æ–±—ã—Ç–∏—è –≤ outbox (DB A)
   - –í—Ä–µ–º—è —Å –º–æ–º–µ–Ω—Ç–∞ –ø–æ—Å–ª–µ–¥–Ω–µ–≥–æ —Å–æ–±—ã—Ç–∏—è –≤ inbox (DB B)
   - **–ù–æ—Ä–º–∞–ª—å–Ω–∞—è –∑–∞–¥–µ—Ä–∂–∫–∞: 1-3 —Å–µ–∫—É–Ω–¥—ã**

### –†—É—á–Ω–∞—è –ø—Ä–æ–≤–µ—Ä–∫–∞
```bash
# –ü–æ—Å–º–æ—Ç—Ä–µ—Ç—å –¥–∞–Ω–Ω—ã–µ –≤ Database A
docker exec -it postgres-a psql -U postgres -d transactions -c "SELECT * FROM users LIMIT 5;"
docker exec -it postgres-a psql -U postgres -d transactions -c "SELECT * FROM payments LIMIT 5;"

# –ü–æ—Å–º–æ—Ç—Ä–µ—Ç—å –¥–∞–Ω–Ω—ã–µ –≤ Database B (–¥–æ–ª–∂–Ω—ã —Å–æ–≤–ø–∞–¥–∞—Ç—å)
docker exec -it postgres-b psql -U postgres -d transactions -c "SELECT * FROM users LIMIT 5;"
docker exec -it postgres-b psql -U postgres -d transactions -c "SELECT * FROM payments LIMIT 5;"

# –ü—Ä–æ–≤–µ—Ä–∏—Ç—å —Å–æ—Å—Ç–æ—è–Ω–∏–µ outbox/inbox (–¥–æ–ª–∂–Ω–æ –±—ã—Ç—å –ø—É—Å—Ç–æ –≤ –Ω–æ—Ä–º–µ)
docker exec -it postgres-a psql -U postgres -d transactions -c "SELECT * FROM outbox WHERE processed = false;"
docker exec -it postgres-b psql -U postgres -d transactions -c "SELECT * FROM inbox ORDER BY created_at DESC LIMIT 5;"
```

## üîß –î–∏–∞–≥–Ω–æ—Å—Ç–∏–∫–∞ –ø—Ä–æ–±–ª–µ–º

### –û—Å–Ω–æ–≤–Ω—ã–µ –∏–Ω–¥–∏–∫–∞—Ç–æ—Ä—ã –ø—Ä–æ–±–ª–µ–º

**üö® –ö—Ä–∏—Ç–∏—á–µ—Å–∫–∏–µ –ø—Ä–æ–±–ª–µ–º—ã:**
- –ë–æ–ª—å—à–æ–µ –∫–æ–ª–∏—á–µ—Å—Ç–≤–æ –Ω–µ–æ–±—Ä–∞–±–æ—Ç–∞–Ω–Ω—ã—Ö —Å–æ–±—ã—Ç–∏–π –≤ outbox (>50)
- –û—Ç—Å—É—Ç—Å—Ç–≤–∏–µ –¥–∞–Ω–Ω—ã—Ö –≤ Database B
- –û—à–∏–±–∫–∏ –≤ –ª–æ–≥–∞—Ö –∫–æ–º–ø–æ–Ω–µ–Ω—Ç–æ–≤

**‚ö†Ô∏è –ü—Ä–æ–±–ª–µ–º—ã –ø—Ä–æ–∏–∑–≤–æ–¥–∏—Ç–µ–ª—å–Ω–æ—Å—Ç–∏:**
- –ó–∞–¥–µ—Ä–∂–∫–∞ —Ä–µ–ø–ª–∏–∫–∞—Ü–∏–∏ >10 —Å–µ–∫—É–Ω–¥
- –ù–∞–∫–æ–ø–ª–µ–Ω–∏–µ —Å–æ–±—ã—Ç–∏–π –≤ outbox/inbox
- –†–∞—Å—Ö–æ–∂–¥–µ–Ω–∏—è –≤ –¥–∞–Ω–Ω—ã—Ö >5 –∑–∞–ø–∏—Å–µ–π

### –ü–æ—à–∞–≥–æ–≤–∞—è –¥–∏–∞–≥–Ω–æ—Å—Ç–∏–∫–∞

1. **–ü—Ä–æ–≤–µ—Ä–∏—Ç—å –ª–æ–≥–∏ –∫–æ–º–ø–æ–Ω–µ–Ω—Ç–æ–≤:**
   ```bash
   ./logs.sh data-generator --tail=20
   ./logs.sh outbox-publisher --tail=20
   ./logs.sh inbox-processor --tail=20
   ```

2. **–¢–∏–ø–∏—á–Ω—ã–µ –æ—à–∏–±–∫–∏ –∏ —Ä–µ—à–µ–Ω–∏—è:**
   
   **–û—à–∏–±–∫–∞ SQL –º–∞—Å—Å–∏–≤–æ–≤:**
   ```
   sql: converting argument $1 type: unsupported type []string
   ```
   ‚úÖ **–†–µ—à–µ–Ω–∏–µ:** –ò—Å–ø—Ä–∞–≤–ª–µ–Ω–æ –≤ —Ç–µ–∫—É—â–µ–π –≤–µ—Ä—Å–∏–∏

   **Foreign key constraint:**
   ```
   violates foreign key constraint "payments_user_id_fkey"
   ```
   ‚úÖ **–†–µ—à–µ–Ω–∏–µ:** –î–æ–±–∞–≤–ª–µ–Ω–∞ —Å–æ—Ä—Ç–∏—Ä–æ–≤–∫–∞ —Å–æ–±—ã—Ç–∏–π (users ‚Üí payments)

   **NATS –ø–æ–¥–∫–ª—é—á–µ–Ω–∏–µ:**
   ```
   Error connecting to NATS
   ```
   üîß **–†–µ—à–µ–Ω–∏–µ:** –ü—Ä–æ–≤–µ—Ä–∏—Ç—å NATS –∫–ª–∞—Å—Ç–µ—Ä—ã –∏ –∞—É—Ç–µ–Ω—Ç–∏—Ñ–∏–∫–∞—Ü–∏—é

3. **–ü—Ä–æ–≤–µ—Ä–∏—Ç—å —Å–æ—Å—Ç–æ—è–Ω–∏–µ NATS:**
   ```bash
   # –°—Ç–∞—Ç—É—Å NATS –∫–ª–∞—Å—Ç–µ—Ä–æ–≤
   curl http://localhost:8222/connz
   curl http://localhost:8223/connz
   
   # Gateway —Å–≤—è–∑–∏ –º–µ–∂–¥—É –∫–ª–∞—Å—Ç–µ—Ä–∞–º–∏
   curl http://localhost:8222/gatewayz
   curl http://localhost:8223/gatewayz
   ```

4. **–ü—Ä–æ–≤–µ—Ä–∏—Ç—å –∫–æ–ª–∏—á–µ—Å—Ç–≤–æ –Ω–µ–æ–±—Ä–∞–±–æ—Ç–∞–Ω–Ω—ã—Ö —Å–æ–±—ã—Ç–∏–π:**
   ```bash
   ./check-replication.sh
   ```

## üéõÔ∏è –ù–∞—Å—Ç—Ä–æ–π–∫–∞ –ø—Ä–æ–∏–∑–≤–æ–¥–∏—Ç–µ–ª—å–Ω–æ—Å—Ç–∏

### –ü–µ—Ä–µ–º–µ–Ω–Ω—ã–µ –æ–∫—Ä—É–∂–µ–Ω–∏—è

**Data Generator:**
- `GENERATION_INTERVAL` - –∏–Ω—Ç–µ—Ä–≤–∞–ª –≥–µ–Ω–µ—Ä–∞—Ü–∏–∏ –¥–∞–Ω–Ω—ã—Ö (–ø–æ —É–º–æ–ª—á–∞–Ω–∏—é: 2 —Å–µ–∫)

**Outbox Publisher:**
- `POLL_INTERVAL` - —á–∞—Å—Ç–æ—Ç–∞ –æ–ø—Ä–æ—Å–∞ outbox (–ø–æ —É–º–æ–ª—á–∞–Ω–∏—é: 0.5 —Å–µ–∫)
- `BATCH_SIZE` - —Ä–∞–∑–º–µ—Ä –ø–∞–∫–µ—Ç–∞ —Å–æ–±—ã—Ç–∏–π (–ø–æ —É–º–æ–ª—á–∞–Ω–∏—é: 25)

**Inbox Processor:**
- `BATCH_SIZE` - —Ä–∞–∑–º–µ—Ä –ø–∞–∫–µ—Ç–∞ —Å–æ–±—ã—Ç–∏–π (–ø–æ —É–º–æ–ª—á–∞–Ω–∏—é: 25)

### –†–µ–∫–æ–º–µ–Ω–¥–∞—Ü–∏–∏ –ø–æ –æ–ø—Ç–∏–º–∏–∑–∞—Ü–∏–∏

**–î–ª—è –≤—ã—Å–æ–∫–æ–π –Ω–∞–≥—Ä—É–∑–∫–∏ (>100 —Å–æ–±—ã—Ç–∏–π/—Å–µ–∫):**
```yaml
# docker-compose.applications.yml
environment:
  POLL_INTERVAL: 0.2        # –£–≤–µ–ª–∏—á–∏—Ç—å —á–∞—Å—Ç–æ—Ç—É –æ–ø—Ä–æ—Å–∞
  BATCH_SIZE: 50            # –£–≤–µ–ª–∏—á–∏—Ç—å —Ä–∞–∑–º–µ—Ä –ø–∞–∫–µ—Ç–∞
  GENERATION_INTERVAL: 5    # –°–Ω–∏–∑–∏—Ç—å —á–∞—Å—Ç–æ—Ç—É –≥–µ–Ω–µ—Ä–∞—Ü–∏–∏
```

**–î–ª—è —ç–∫–æ–Ω–æ–º–∏–∏ —Ä–µ—Å—É—Ä—Å–æ–≤:**
```yaml
environment:
  POLL_INTERVAL: 2          # –°–Ω–∏–∑–∏—Ç—å —á–∞—Å—Ç–æ—Ç—É –æ–ø—Ä–æ—Å–∞
  BATCH_SIZE: 10            # –£–º–µ–Ω—å—à–∏—Ç—å —Ä–∞–∑–º–µ—Ä –ø–∞–∫–µ—Ç–∞
  GENERATION_INTERVAL: 1    # –£–≤–µ–ª–∏—á–∏—Ç—å —á–∞—Å—Ç–æ—Ç—É –≥–µ–Ω–µ—Ä–∞—Ü–∏–∏
```

## üîß NATS Gateway –ö–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏—è

### –§–∞–π–ª—ã –∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏–∏

**cluster-a.conf:**
- Account: CLIENT (JetStream enabled)
- User: replication:password123
- Gateway: CLUSTER_A ‚Üî CLUSTER_B

**cluster-b.conf:**
- Account: CLIENT (JetStream enabled)  
- User: replication:password123
- Gateway: CLUSTER_B ‚Üî CLUSTER_A

### –ú–æ–Ω–∏—Ç–æ—Ä–∏–Ω–≥ Gateway

```bash
# –ü—Ä–æ–≤–µ—Ä–∏—Ç—å —Å–æ—Å—Ç–æ—è–Ω–∏–µ gateway —Å–æ–µ–¥–∏–Ω–µ–Ω–∏–π
curl http://localhost:8222/gatewayz | jq '.gateways'
curl http://localhost:8223/gatewayz | jq '.gateways'

# –ü—Ä–æ–≤–µ—Ä–∏—Ç—å JetStream —Å—Ç–∞—Ç–∏—Å—Ç–∏–∫—É
curl http://localhost:8222/jsz
curl http://localhost:8223/jsz
```

## üíæ –°—Ö–µ–º–∞ –ë–î

### –û—Å–Ω–æ–≤–Ω—ã–µ —Ç–∞–±–ª–∏—Ü—ã (–≤ –æ–±–µ–∏—Ö –ë–î):
- `users` - –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–∏ —Å–∏—Å—Ç–µ–º—ã
- `payments` - –ø–ª–∞—Ç–µ–∂–∏ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–π

### –°–ø–µ—Ü–∏–∞–ª—å–Ω—ã–µ —Ç–∞–±–ª–∏—Ü—ã:
- `outbox` (—Ç–æ–ª—å–∫–æ DB A) - –∏—Å—Ö–æ–¥—è—â–∏–µ —Å–æ–±—ã—Ç–∏—è –¥–ª—è —Ä–µ–ø–ª–∏–∫–∞—Ü–∏–∏
- `inbox` (—Ç–æ–ª—å–∫–æ DB B) - –≤—Ö–æ–¥—è—â–∏–µ —Å–æ–±—ã—Ç–∏—è –∏–∑ —Ä–µ–ø–ª–∏–∫–∞—Ü–∏–∏
- `processed_events` (—Ç–æ–ª—å–∫–æ DB B) - –¥–µ–¥—É–ø–ª–∏–∫–∞—Ü–∏—è –æ–±—Ä–∞–±–æ—Ç–∞–Ω–Ω—ã—Ö —Å–æ–±—ã—Ç–∏–π

### –¢—Ä–∏–≥–≥–µ—Ä—ã –∏ —Ñ—É–Ω–∫—Ü–∏–∏:
- **DB A**: –ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–æ–µ —Å–æ–∑–¥–∞–Ω–∏–µ —Å–æ–±—ã—Ç–∏–π –≤ outbox –ø—Ä–∏ INSERT/UPDATE
- **DB B**: –§—É–Ω–∫—Ü–∏–∏ –æ–±—Ä–∞–±–æ—Ç–∫–∏ —Å–æ–±—ã—Ç–∏–π —Å –¥–µ–¥—É–ø–ª–∏–∫–∞—Ü–∏–µ–π

## ‚ö° –ì–∞—Ä–∞–Ω—Ç–∏–∏ –Ω–∞–¥–µ–∂–Ω–æ—Å—Ç–∏

- **–ö–æ–Ω—Å–∏—Å—Ç–µ–Ω—Ç–Ω–æ—Å—Ç—å**: outbox –∑–∞–ø–∏—Å—ã–≤–∞–µ—Ç—Å—è –≤ —Ç–æ–π –∂–µ —Ç—Ä–∞–Ω–∑–∞–∫—Ü–∏–∏ —á—Ç–æ –∏ –æ—Å–Ω–æ–≤–Ω—ã–µ –¥–∞–Ω–Ω—ã–µ
- **–ò–¥–µ–º–ø–æ—Ç–µ–Ω—Ç–Ω–æ—Å—Ç—å**: –∫–∞–∂–¥–æ–µ —Å–æ–±—ã—Ç–∏–µ –∏–º–µ–µ—Ç —É–Ω–∏–∫–∞–ª—å–Ω—ã–π UUID + –¥–µ–¥—É–ø–ª–∏–∫–∞—Ü–∏—è
- **At-least-once delivery**: NATS JetStream —Å persistent storage
- **Fault tolerance**: —Å–∏—Å—Ç–µ–º–∞ –≤–æ—Å—Å—Ç–∞–Ω–∞–≤–ª–∏–≤–∞–µ—Ç—Å—è –ø–æ—Å–ª–µ —Å–±–æ–µ–≤ –ª—é–±–æ–≥–æ –∫–æ–º–ø–æ–Ω–µ–Ω—Ç–∞
- **Event ordering**: –ø—Ä–∞–≤–∏–ª—å–Ω–∞—è —Å–æ—Ä—Ç–∏—Ä–æ–≤–∫–∞ —Å–æ–±—ã—Ç–∏–π (users –ø–µ—Ä–µ–¥ payments)
- **Gateway —Ä–µ–ø–ª–∏–∫–∞—Ü–∏—è**: NATS –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏ —Ä–µ–ø–ª–∏—Ü–∏—Ä—É–µ—Ç –º–µ–∂–¥—É –∫–ª–∞—Å—Ç–µ—Ä–∞–º–∏
- **Near real-time**: –∑–∞–¥–µ—Ä–∂–∫–∞ —Ä–µ–ø–ª–∏–∫–∞—Ü–∏–∏ 1-3 —Å–µ–∫—É–Ω–¥—ã –≤ –Ω–æ—Ä–º–∞–ª—å–Ω–æ–º —Ä–µ–∂–∏–º–µ

## üéØ –†–µ–∑—É–ª—å—Ç–∞—Ç—ã —Ç–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏—è

**–ü—Ä–æ–∏–∑–≤–æ–¥–∏—Ç–µ–ª—å–Ω–æ—Å—Ç—å —Å–∏—Å—Ç–µ–º—ã:**
- ‚úÖ –ü—Ä–æ–ø—É—Å–∫–Ω–∞—è —Å–ø–æ—Å–æ–±–Ω–æ—Å—Ç—å: 50+ —Å–æ–±—ã—Ç–∏–π/—Å–µ–∫—É–Ω–¥—É
- ‚úÖ –ó–∞–¥–µ—Ä–∂–∫–∞ —Ä–µ–ø–ª–∏–∫–∞—Ü–∏–∏: 1-2 —Å–µ–∫—É–Ω–¥—ã
- ‚úÖ –ò–¥–µ–º–ø–æ—Ç–µ–Ω—Ç–Ω–æ—Å—Ç—å: 100% (–¥—É–±–ª–∏–∫–∞—Ç—ã –æ—Ç—Ñ–∏–ª—å—Ç—Ä–æ–≤—ã–≤–∞—é—Ç—Å—è)
- ‚úÖ –ö–æ–Ω—Å–∏—Å—Ç–µ–Ω—Ç–Ω–æ—Å—Ç—å: 100% (–¥–∞–Ω–Ω—ã–µ –ø–æ–ª–Ω–æ—Å—Ç—å—é —Å–∏–Ω—Ö—Ä–æ–Ω–∏–∑–∏—Ä–æ–≤–∞–Ω—ã)
- ‚úÖ Fault tolerance: –≤–æ—Å—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω–∏–µ –ø–æ—Å–ª–µ —Å–±–æ–µ–≤ < 30 —Å–µ–∫—É–Ω–¥

**–¢–µ—Å—Ç–æ–≤–∞—è –Ω–∞–≥—Ä—É–∑–∫–∞:**
- 400+ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–π —Ä–µ–ø–ª–∏—Ü–∏—Ä–æ–≤–∞–Ω—ã –±–µ–∑ –æ—à–∏–±–æ–∫
- 1600+ –ø–ª–∞—Ç–µ–∂–µ–π —Ä–µ–ø–ª–∏—Ü–∏—Ä–æ–≤–∞–Ω—ã –±–µ–∑ –æ—à–∏–±–æ–∫  
- 2000+ —Å–æ–±—ã—Ç–∏–π –æ–±—Ä–∞–±–æ—Ç–∞–Ω–æ –±–µ–∑ –ø–æ—Ç–µ—Ä—å
- 0 –Ω–µ–æ–±—Ä–∞–±–æ—Ç–∞–Ω–Ω—ã—Ö —Å–æ–±—ã—Ç–∏–π –≤ —É—Å—Ç–∞–Ω–æ–≤–∏–≤—à–µ–º—Å—è —Ä–µ–∂–∏–º–µ 